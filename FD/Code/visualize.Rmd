---
title: "visualize"
author: "Daniela Wiepert"
date: "3/8/2021"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(ggpubr)
options(stringAsFactors = FALSE)
setwd("/Users/danielawiepert/Desktop/XPF-soft-constraints/FD/Code")
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r read}
lang_codes <- read.csv("Data/filtered_codes5000_3.tsv", sep='\t', header=F)
colnames(lang_codes) <- c("a","b","c")
lang_codes <- unite(lang_codes,"code",'a','b','c',sep='')
head(lang_codes)
lang_codes <- lang_codes %>%
  arrange(by=code)

# vectors of percentiles
final_voiced_obstruents <- c()
final_voiceless_obstruents <- c()
final_obstruents <- c()

# vectors of plots 
final_voiced_obstruents_plots <- list()
final_voiceless_obstruents_plots <- list()
final_obstruents_plots <- list()
```


```{r get-distributions}
# For each lang code, get artificial distribution and natural value
# for (code in lang_codes$code) {

for (i in c(1:nrow(lang_codes))) {
  i = i+1
  if(i <= nrow(lang_codes)){
    print(i)
  }
}

print(lang_codes[1])



for (i in c(1:nrow(lang_codes))) {
  
  code <- lang_codes$code[i]
  artificial <- read.csv(paste("Data/distributions/", code, "_artificial.csv", sep=""))
  artificial <- artificial*100

  natural <- read.csv(paste("Data/distributions/", code, "_natural.csv", sep=""))
  natural <- natural *100
  # multiplication by 100 is so that it's in terms of percent (5% instead of 0.05)
  
  # final voiced obstruents
  
  final_voiced_obstruents_plot <- ggplot(data.frame(x=artificial$final_voiced_obstruents), aes(x, color="red")) +
    geom_density(aes(y=..scaled..)) + 
    theme_minimal() + 
    theme(legend.position = "none") + 
    xlab("Violations (%)") +
    ylab("Density") + 
    ggtitle(paste(code, "final voiced obstruents")) +
    geom_vline(xintercept=natural$final_voiced_obstruents)
  # ggsave(same_fricatives_plot, file=paste("visualizations/", code, "_same_fricatives.pdf", sep=""), height=4, width=8)
  final_voiced_obstruents_percentile <- ecdf(artificial$final_voiced_obstruents)(natural$final_voiced_obstruents)
  final_voiced_obstruents <- append(final_voiced_obstruents, final_voiced_obstruents_percentile)
  final_voiced_obstruents_plots[[i]] = final_voiced_obstruents_plot
  
  # final obstruents
 final_obstruents_plot <- ggplot(data.frame(x=artificial$final_obstruents), aes(x, color="red")) +
    geom_density(aes(y=..scaled..)) + 
    theme_minimal() + 
    theme(legend.position = "none") + 
    xlab("Violations (%)") +
    ylab("Density") + 
    ggtitle(paste(code, "final obstruents")) +
    geom_vline(xintercept=natural$final_obstruents)
  # ggsave(same_fricatives_plot, file=paste("visualizations/", code, "_same_fricatives.pdf", sep=""), height=4, width=8)
  final_obstruents_percentile <- ecdf(artificial$final_obstruents)(natural$final_obstruents)
  final_obstruents <- append(final_obstruents, final_obstruents_percentile)
  final_obstruents_plots[[i]] = final_obstruents_plot
  
  # final voiceless obstruents
  final_voiceless_obstruents_plot <- ggplot(data.frame(x=artificial$final_voiceless_obstruents), aes(x, color="red")) +
    geom_density(aes(y=..scaled..)) + 
    theme_minimal() + 
    theme(legend.position = "none") + 
    xlab("Violations (%)") +
    ylab("Density") + 
    ggtitle(paste(code, "final voiceless obstruents")) +
    geom_vline(xintercept=natural$final_voiceless_obstruents)
  # ggsave(same_fricatives_plot, file=paste("visualizations/", code, "_same_fricatives.pdf", sep=""), height=4, width=8)
  final_voiceless_obstruents_percentile <- ecdf(artificial$final_voiceless_obstruents)(natural$final_voiceless_obstruents)
  final_voiceless_obstruents <- append(final_voiceless_obstruents, final_voiceless_obstruents_percentile)
  final_voiceless_obstruents_plots[[i]] = final_voiceless_obstruents_plot
}
```

```{r reg-plots}
ggsave(file="Data/plots/final_voiced-filtered.pdf", gridExtra::arrangeGrob(grobs=final_voiced_obstruents_plots[1:16], labels=lang_codes$code), width=12, height=8)
ggsave(file="Data/plots/final_voiced_2-filtered.pdf", gridExtra::arrangeGrob(grobs=final_voiced_obstruents_plots[17:32], labels=lang_codes$code), width=12, height=8)
ggsave(file="Data/plots/final_voiced_3-filtered.pdf", gridExtra::arrangeGrob(grobs=final_voiced_obstruents_plots[33:45], labels=lang_codes$code), width=12, height=8)
# ggsave(file="Data/final_voiced.pdf", gridExtra::arrangeGrob(grobs=final_voiced_obstruents_plots[1:30], labels=lang_codes$code), width=12, height=8)
# ggsave(file="Data/final_voiced_2.pdf", gridExtra::arrangeGrob(grobs=final_voiced_obstruents_plots[31:60], labels=lang_codes$code), width=12, height=8)
# ggsave(file="Data/final_voiced_3.pdf", gridExtra::arrangeGrob(grobs=final_voiced_obstruents_plots[61:77], labels=lang_codes$code), width=12, height=8)

# ggsave(file="Data/final_voiceless.pdf", gridExtra::arrangeGrob(grobs=final_voiceless_obstruents_plots[1:30], labels=lang_codes$code), width=12, height=8)
# ggsave(file="Data/final_voiceless_2.pdf", gridExtra::arrangeGrob(grobs=final_voiceless_obstruents_plots[31:60], labels=lang_codes$code), width=12, height=8)
# ggsave(file="Data/final_voiceless_3.pdf", gridExtra::arrangeGrob(grobs=final_voiceless_obstruents_plots[61:77], labels=lang_codes$code), width=12, height=8)
# 
# ggsave(file="Data/final_obstruent.pdf", gridExtra::arrangeGrob(grobs=final_obstruents_plots[1:30], labels=lang_codes$code), width=12, height=8)
# ggsave(file="Data/final_obstruent_2.pdf", gridExtra::arrangeGrob(grobs=final_obstruents_plots[31:60], labels=lang_codes$code), width=12, height=8)
# ggsave(file="Data/final_obstruent_3.pdf", gridExtra::arrangeGrob(grobs=final_obstruents_plots[61:77], labels=lang_codes$code), width=12, height=8)
```

```{r den-plots}
percentiles <- data.frame(lang_codes$code, final_voiced_obstruents, final_obstruents)
#write.csv(percentiles, "Data/percentile.csv")
write.csv(percentiles, "Data/percentiles-filtered.csv")

final_voiced_percentile_density <- ggplot(data.frame(x=percentiles$final_voiced_obstruents), aes(x, fill="red")) + 
  geom_density(aes(y=..scaled..)) + 
  theme_minimal() + 
  theme(legend.position = "none") + 
  ggtitle("Distribution of final voiced obstruent percentiles") + 
  xlab("Percentile of natural language percent of violations compared to generated distribution") + 
  ylab("Density")
#ggsave(final_voiced_percentile_density, file="Data/final_voiced_percentile_density.pdf", height=4, width=8)
ggsave(final_voiced_percentile_density, file="Data/plots/final_voiced_percentile_density-filtered.pdf", height=4, width=8)

# final_voiceless_percentile_density <- ggplot(data.frame(x=percentiles$final_voiceless_obstruents), aes(x, fill="red")) + 
#   geom_density(aes(y=..scaled..)) + 
#   theme_minimal() + 
#   theme(legend.position = "none") + 
#   ggtitle("Distribution of final voiceless obstruent percentiles") + 
#   xlab("Percentile of natural language percent of violations compared to generated distribution") + 
#   ylab("Density")
# ggsave(final_voiceless_percentile_density, file="Data/final_voiceless_percentile_density.pdf", height=4, width=8)
# 
# final_obstruents_percentile_density <- ggplot(data.frame(x=percentiles$final_obstruents), aes(x, fill="red")) + 
#   geom_density(aes(y=..scaled..)) + 
#   theme_minimal() + 
#   theme(legend.position = "none") + 
#   ggtitle("Distribution of final obstruent percentiles") + 
#   xlab("Percentile of natural language percent of violations compared to generated distribution") + 
#   ylab("Density")
# ggsave(final_obstruents_percentile_density, file="Data/final_obstruent_percentile_density.pdf", height=4, width=8)

# ggsave(file="Data/percentile_density_plots.pdf", 
#        gridExtra::arrangeGrob(grobs=list(final_voiced_percentile_density,
#                                          final_voiceless_percentile_density,
#                                          final_obstruents_percentile_density)),
#        height=8, width=16)
```

